import{r as t,c as e,h as i,H as s}from"./p-09054bd8.js";import{f as r,a as l,g as n,s as a,b as o}from"./p-849d17b4.js";const h=":host{display:block;font-family:sans-serif}.filter{max-width:800px}.help{margin:1em 0;padding:1em 0 1em 1em;border:thin solid #0f9535;max-width:780px}.filter{position:relative}dc-map{height:400px;width:400px}dc-feature-summary{position:absolute;top:250px;background-color:rgba(255,255,255, 0.8);width:300px}dc-filter{margin-top:0.5em}ol{padding:0;font:italic 2em Georgia;color:#666;list-style-position:outside;padding-left:1.5em}ol dc-election-question{font:normal 16px Helvetica, Arial, Sans-Serif;color:#000}ol li{border-top:thin solid #444;margin-top:1em}input{font-size:1.2em;height:2em;width:12em;margin:0 1em}";const d=class{constructor(i){t(this,i);this.filterChanged=e(this,"filterChanged",6);this.filename=null;this.format="column";this.candidatesFiles=null;this.filter=null;this.showFilter=false;this.candidates=[];this.questions=[];this.loading=true;this.stopFilterPropagation=false}async componentDidLoad(){this.questions=await r(this.filename,this.format);if(!!this.candidatesFiles){this.candidates=await l(this.candidatesFiles)}this.filter=n();if(!!this.filter){a.filter=this.filter}this.loading=false}featureSelectedHandler(t){this.stopFilterPropagation=true;if(t.detail.feature!==undefined){console.debug("dc-election-survey: featureSelectedHandler",t.detail.feature.attributes);this.featureSummaryEl.race=t.detail.feature.attributes.SMD_ID;this.featureSummaryEl.website=t.detail.feature.attributes.WEB_URL;this.filter=t.detail.feature.attributes.ANC_ID}else{this.filter="";this.featureSummaryEl.race=""}a.filter=this.filter}filterChangedHandler(t){this.filter=t.detail.value;if(!this.stopFilterPropagation){this.featureSummaryEl.race=t.detail.value}this.stopFilterPropagation=false}filterPropChanged(t){if(!!this.filterDropdownEl){this.filterDropdownEl.value=t}o(t);const e={attributes:{ANC_ID:t.slice(0,2)}};if(t.length===4){e.attributes["SMD_ID"]=t}if(!this.stopFilterPropagation&&!!this.mapEl){this.mapEl.selectFeature(e,false);a.filter=t}}clearFilters(){this.filter="";a.filter="";if(this.filterInput){this.filterInput.value=""}return false}renderFilter(t){console.debug("dc-election-survey: renderFilter",{filter:t});if(this.showFilter){return i("div",{class:"filter"},i("slot",{name:"filter"}),i("dc-map",{ref:t=>this.mapEl=t}),i("dc-feature-summary",{candidates:this.candidates,ref:t=>this.featureSummaryEl=t}),i("dc-filter",{ref:t=>this.filterDropdownEl=t,filter:t}))}}renderQuestion(t){return i("dc-election-question",{question:t.question,responses:t.responses,type:t.question.Type})}renderHelp(){return i("div",null,i("div",{class:"help"},"Filter to local candidates by clicking on the map, search by address, or select ANC or SMD."),this.renderSummary())}renderSummary(){return i("dc-survey-summary",{class:"summary",questions:this.questions})}renderBody(t){const e=i("ol",null,this.questions.map((t=>i("li",null,this.renderQuestion(t)))));return i("div",{class:"questions"},this.renderFilter(t),!this.showFilter||t===null||!!t&&t.length!==0?e:this.renderHelp())}renderLoader(){return i("dc-loader",null,"Loading survey responses...")}render(){return i(s,null,i("slot",{name:"title"}),this.loading||this.questions.length===0?this.renderLoader():this.renderBody(this.filter))}static get watchers(){return{filter:["filterPropChanged"]}}};d.style=h;export{d as dc_election_survey};
//# sourceMappingURL=p-8c563c2d.entry.js.map