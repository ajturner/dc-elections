import{r as t,c as i,h as s,H as e}from"./p-09054bd8.js";import{f as r,a as l,g as h,s as n,b as a}from"./p-849d17b4.js";const o=class{constructor(s){t(this,s),this.filterChanged=i(this,"filterChanged",6),this.filename=null,this.format="column",this.candidatesFile=null,this.filter=null,this.showFilter=!1,this.candidates=[],this.questions=[],this.loading=!0,this.stopFilterPropagation=!1}async componentDidLoad(){this.questions=await r(this.filename,this.format),this.candidatesFile&&(this.candidates=await l(this.candidatesFile)),this.filter=h(),this.filter&&(n.filter=this.filter),this.loading=!1}featureSelectedHandler(t){this.stopFilterPropagation=!0,void 0!==t.detail.feature?(console.debug("dc-election-survey: featureSelectedHandler",t.detail.feature.attributes),this.featureSummaryEl.race=t.detail.feature.attributes.SMD_ID,this.featureSummaryEl.website=t.detail.feature.attributes.WEB_URL,this.filter=t.detail.feature.attributes.ANC_ID):(this.filter="",this.featureSummaryEl.race=""),n.filter=this.filter}filterChangedHandler(t){this.filter=t.detail.value,this.stopFilterPropagation||(this.featureSummaryEl.race=t.detail.value),this.stopFilterPropagation=!1}filterPropChanged(t){this.filterDropdownEl&&(this.filterDropdownEl.value=t),a(t);const i={attributes:{ANC_ID:t.slice(0,2)}};4===t.length&&(i.attributes.SMD_ID=t),!this.stopFilterPropagation&&this.mapEl&&(this.mapEl.selectFeature(i,!1),n.filter=t)}clearFilters(){return this.filter="",n.filter="",this.filterInput&&(this.filterInput.value=""),!1}renderFilter(t){if(this.showFilter)return s("div",{class:"filter"},s("slot",{name:"filter"}),s("dc-map",{ref:t=>this.mapEl=t}),s("dc-feature-summary",{candidates:this.candidates,ref:t=>this.featureSummaryEl=t}),s("dc-filter",{ref:t=>this.filterDropdownEl=t,filter:t}))}renderQuestion(t){return s("dc-election-question",{question:t.question,responses:t.responses,type:t.question.Type})}renderHelp(){return s("div",null,s("div",{class:"help"},"Filter to local candidates by clicking on the map, search by address, or select ANC or SMD."),this.renderSummary())}renderSummary(){return s("dc-survey-summary",{class:"summary",questions:this.questions})}renderBody(t){const i=s("ol",null,this.questions.map((t=>s("li",null,this.renderQuestion(t)))));return s("div",{class:"questions"},this.renderFilter(t),!this.showFilter||null===t||t&&0!==t.length?i:this.renderHelp())}renderLoader(){return s("dc-loader",null,"Loading survey responses...")}render(){return s(e,null,s("slot",{name:"title"}),this.loading||0===this.questions.length?this.renderLoader():this.renderBody(this.filter))}static get watchers(){return{filter:["filterPropChanged"]}}};o.style=":host{display:block;font-family:sans-serif}.filter{max-width:800px}.help{margin:1em 0;padding:1em 0 1em 1em;border:thin solid #0f9535;max-width:780px}dc-map{height:400px;width:400px}dc-feature-summary{position:absolute;top:250px;background-color:rgba(255,255,255, 0.8);width:300px}ol{padding:0;font:italic 2em Georgia;color:#666;list-style-position:outside;padding-left:1.5em}ol dc-election-question{font:normal 16px Helvetica, Arial, Sans-Serif;color:#000}ol li{border-top:thin solid #444;margin-top:1em}input{font-size:1.2em;height:2em;width:12em;margin:0 1em}";export{o as dc_election_survey}