import{r as e,h as t,H as s,c as i}from"./p-83c3088b.js";import{I as r,s as o}from"./p-3bc77c57.js";function n(e,t,s){return function(e,t="Race",s="asc"){const i="asc"===s?1:-1;return e.sort(((e,s)=>{let r=e[t],o=s[t];return void 0===r&&e.candidates&&void 0!==r.candidates[t]&&(r=r.candidates[t],o=o.candidates[t]),r>o?i:-i}))}(e,t,s)}const a=class{constructor(t){e(this,t),this.question=null,this.showNoResponse=!1,this.type=r.Choice,this.responses=[]}applyFilters(e){return o.filter&&0!==o.filter.length?e.filter((e=>e.Race.match(o.filter))):e}renderNoResponse(){return t("div",null,"We did not receive any responses from candidates in this jurisdiction")}renderResponse(e,s=2){const i=this.applyFilters(e.candidates);if("No Response"!==e.response&&0!==i.length){let s=e.response.replace(/^[0-9]\.\s+/,"").replace(/(?:\r\n|\r|\n)/g,"<br>"),o="grid";switch(this.type){case r.Choice:return t("div",{class:"response-gallery"},t("dc-election-gallery",{appearance:o,candidates:n(i,"Race")},t("div",{class:"response",innerHTML:s})));case r.Text:o="quote";const e=n(i,"Race","desc");return t("div",{class:"response-quote"},t("dc-election-gallery",{appearance:o,candidates:e}),t("div",{class:"response",innerHTML:s}));case r.Rank:case r.Option:o="quote";const a=s.split("|");return s=t("ol",{class:"rank-options"},a.map((e=>this.formatRankOptions(e)))),t("div",{class:"response-rank"},t("dc-election-gallery",{appearance:o,candidates:n(i,"Race")}),t("div",{class:"response"},s))}}else if(this.showNoResponse){const s=e.candidates.map((e=>null==e?void 0:e.Candidate));return t("div",{class:"footnote"},"No response from ",n(s).join(", "))}}formatRankOptions(e){let s="unranked";switch(!0){case/\~(.*)\~/g.test(e):s="omit";break;case/^#/.test(e):s="ranked",e=e.replace(/^#/,"")}return e=e.replace(/\~(.*)\~ (\([\w\s]+\))/g,"<span class='text'>$1</span> <span class='comment'>$2</span>"),t("li",{class:s,innerHTML:e=`<span>${e}</span>`})}renderQuestion(e){const s=e.Question.replace(/(?:\r\n|\r|\n)/g,"<br>");let i="",r=s;try{[,i,r]=s.match(/_(.*)_(.*)/)}catch(e){}return[t("span",{class:"preface",innerHTML:i}),t("span",{class:"focus",innerHTML:r})]}render(){const e=n(this.responses,"response","asc");return t(s,null,t("slot",null),this.renderQuestion(this.question),t("div",{class:`response layout-${this.type.toLowerCase()}`},0===e.length?this.renderNoResponse():null,e.map((e=>this.renderResponse(e,this.responses.length)))))}};a.style=':host{display:block;}.preface{font-weight:300;font-size:1em;display:block}.focus{font-weight:800;font-size:1.2em;padding-top:0.3em;padding-bottom:0.5em;position:sticky;background-color:white;opacity:0.9;top:0px;display:block}.response:empty::before{content:"No response to this question.";font-style:italic;font-weight:400}.response{font-weight:600;font-size:1em;padding:1em 0;margin-top:0.5em}.response-gallery .response::before{content:"\\203A"}.footnote{font-weight:300px;font-size:0.8em;font-style:italic;padding-top:0.5em}.layout-choice{display:grid;grid-gap:0.3em;grid-template-columns:repeat( auto-fit, minmax(400px, 1fr) )}.layout-choice .response{padding:0 0.3em 0.3em 0.3em;vertical-align:bottom}.response-quote,.response-rank{display:grid;grid-template-columns:0.1fr 1fr;padding:1em 0;border-bottom:thin solid #DDD}.response-rank .response{font-weight:300;padding:0}.response-quote .response{font-weight:400;font-size:1em;padding:0.4em;font-style:oblique;quotes:"\\201C""\\201D""\\2018""\\2019"}.response-quote .response:before{content:open-quote;color:#ccc;font-size:3em;line-height:0.1em;margin-right:0.25em;vertical-align:-0.4em}.response-quote .response:after{content:close-quote;color:#ccc;font-size:3em;line-height:0.1em;margin-right:0.25em;vertical-align:-0.4em}.rank-options{padding:0;margin:0;font:italic 1em Georgia;color:#666}.rank-options span{font:normal 1em Arial;color:#000}.rank-options li{border:1px solid #CCC;padding:0.5em;margin-left:1.5em;margin-bottom:0.5em}.rank-options .ranked{border:1px solid #0f9535}.rank-options li.omit,.rank-options li.unranked{list-style:none}.omit .text{font:normal 1em Arial;text-decoration:line-through;color:#555}.omit .comment{display:inline-block;text-decoration:unset;font-weight:100;padding-left:0.5em;font-style:italic}';const l=class{constructor(t){e(this,t),this.filterChanged=i(this,"filterChanged",6),this.filter="",this.url="https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Administrative_Other_Boundaries_WebMercator/MapServer/55/query?where=1%3D1&text=&objectIds=&time=&timeRelation=esriTimeRelationOverlaps&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&distance=&units=esriSRUnit_Foot&relationParam=&outFields=ANC_ID%2CSMD_ID&returnGeometry=false&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&havingClause=&returnIdsOnly=false&returnCountOnly=false&orderByFields=SMD_ID&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&historicMoment=&returnDistinctValues=false&resultOffset=&resultRecordCount=&returnExtentOnly=false&sqlFormat=none&datumTransformation=&parameterValues=&rangeValues=&quantizationParameters=&featureEncoding=esriDefault&f=json",this.m_filterOptions=[]}componentWillLoad(){this.fetchOptions()}async fetchOptions(){const e=[],t=await fetch(this.url);(await t.json()).features.map((t=>{e.push({ANC_ID:t.attributes.ANC_ID,SMD_ID:t.attributes.SMD_ID})})),this.m_filterOptions=e}groupBy(e,t){return e.reduce((function(e,s){return e[s[t]]=e[s[t]]||[],e[s[t]].push(s),e}),Object.create(null))}dropdownChangedHandler(e){this.filterChanged.emit({value:this.m_dropdownEl.value})}filterPropChanged(e){this.m_dropdownEl.value=e}renderOption(e,s=null){return t("calcite-combobox-item",{value:e,textLabel:e,selected:e===this.filter},s)}render(){const e=this.groupBy(this.m_filterOptions,"ANC_ID"),i=[];for(let t in e){const s=e[t].map((e=>this.renderOption(e.SMD_ID)));i.push(this.renderOption(t,s))}return t(s,null,t("slot",null),t("div",null,t("calcite-combobox",{ref:e=>this.m_dropdownEl=e,label:"search",placeholder:"Search by ANC","selection-mode":"single",scale:"m","max-items":"0"},i)))}static get watchers(){return{filter:["filterPropChanged"]}}};l.style=":host{display:block}";const c=class{constructor(t){e(this,t)}render(){return t(s,null,t("div",{class:"message"},t("slot",null)),t("div",{id:"arrowAnim"},t("div",{class:"arrowSliding"},t("div",{class:"arrow"})),t("div",{class:"arrowSliding delay1"},t("div",{class:"arrow"})),t("div",{class:"arrowSliding delay2"},t("div",{class:"arrow"})),t("div",{class:"arrowSliding delay3"},t("div",{class:"arrow"}))))}};c.style=":host{display:block}.message{font-weight:400;font-style:italic;color:#444;text-align:center}#arrowAnim{width:100vw;height:80vh;display:flex;justify-content:center;align-items:center;color:blue}.arrow{width:5vw;height:5vw;border:2.5vw solid;border-color:#0f9535 transparent transparent #0f9535;transform:rotate(135deg)}.arrowSliding{position:absolute;-webkit-animation:slide 4s linear infinite;animation:slide 4s linear infinite}.delay1{-webkit-animation-delay:1s;animation-delay:1s}.delay2{-webkit-animation-delay:2s;animation-delay:2s}.delay3{-webkit-animation-delay:3s;animation-delay:3s}@-webkit-keyframes slide{0%{opacity:0;transform:translateX(15vw)}20%{opacity:1;transform:translateX(9vw)}80%{opacity:1;transform:translateX(-9vw)}100%{opacity:0;transform:translateX(-15vw)}}@keyframes slide{0%{opacity:0;transform:translateX(15vw)}20%{opacity:1;transform:translateX(9vw)}80%{opacity:1;transform:translateX(-9vw)}100%{opacity:0;transform:translateX(-15vw)}}";const d=class{constructor(t){e(this,t),this.filterChanged=i(this,"filterChanged",6),this.m_layers={}}async handleMapViewReady(e){const{detail:{view:t,loadModules:s}}=e;this.m_view=t,s(["esri/geometry/Extent","esri/layers/FeatureLayer","esri/widgets/Home","esri/layers/support/LabelClass","esri/widgets/Search"]).then((([e,s,i,r,o])=>{const n=new r({labelExpressionInfo:{expression:"$feature.NAME"},symbol:{type:"text",color:"white",haloSize:.5,haloColor:"black",font:{size:12,weight:"bold"}}});this.m_layers.ancLayer=new s({url:"https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Administrative_Other_Boundaries_WebMercator/MapServer/54",renderer:{type:"simple",symbol:{type:"simple-fill",opacity:1,outline:{width:1,color:[60,60,60,.5]}}},labelingInfo:[n]});const a=new r({labelExpressionInfo:{expression:"$feature.SMD_ID"},symbol:{type:"text",color:"white",haloSize:.5,haloColor:"black",font:{size:8},maxScale:0,minScale:1e6}});this.m_layers.smdLayer=new s({url:"https://maps2.dcgis.dc.gov/dcgis/rest/services/DCGIS_DATA/Administrative_Other_Boundaries_WebMercator/MapServer/55",renderer:{type:"simple",symbol:{type:"simple-fill",opacity:0,outline:{width:.5,color:"white"}}},labelingInfo:[a]}),this.m_view.map.add(this.m_layers.smdLayer),this.m_view.map.add(this.m_layers.ancLayer),this.m_view.highlightOptions={color:"#0f9535"};const l=new e({xmin:-8584947.85844689,ymin:4691862.387048862,xmax:-8561472.787091771,ymax:4721095.072076196,spatialReference:{wkid:3857}});this.m_view.constraints={geometry:l,minScale:5e5,maxScale:1e4,rotationEnabled:!1};const c=new o({view:this.m_view,includeDefaultSources:!1,sources:[{url:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",name:"DC Address Search",zoomScale:5e4,popupEnabled:!1,filter:{geometry:l}},{layer:this.m_layers.ancLayer,placeholder:"Search ANC",maxResults:5,searchFields:["NAME"],displayField:"NAME",name:"DC ANC"}]});this.m_view.ui.add(c,{position:"top-left",index:2});let d=new i({view:this.m_view});t.ui.add(d,"top-left"),t.ui.move("zoom","top-right"),c.on("search-complete",(function(e){let t=e.results[0].results[0].feature,s=this.m_layerView.createQuery();s.geometry=t.geometry,this.m_layers.smdLayer.queryFeatures(s).then((e=>{this.setFilter(e.features[0].attributes.SMD_ID)}))})),this.m_view.when().then((()=>this.m_layers.ancLayer.when())).then((e=>this.m_view.whenLayerView(e))).then((e=>{this.m_layerView=e,this.m_view.on("pointer-move",(e=>{this.mapMouseHandler(e)})),this.m_view.on("pointer-down",(e=>{this.mapMouseHandler(e)}))}))}))}mapMouseHandler(e){this.m_view.hitTest(e,{include:this.m_layers.ancLayer}).then((t=>{t.results.length&&(this.highlightFeature(t.results[0].graphic),"pointer-down"===e.type&&this.setFilter(this.m_currentFilter))}))}setFilter(e){e=e.slice(0,2),this.selectFeature({attributes:{NAME:e}}),this.filterChanged.emit({value:e})}selectFeature(e){const t=this.m_layerView.createQuery();t.where=`NAME = '${e.attributes.NAME}'`,this.m_layerView.queryFeatures(t).then((e=>{this.m_highlight&&this.m_highlight.remove();let t=e.features[0];this.m_highlight=this.m_layerView.highlight(t.attributes.OBJECTID),this.m_view.goTo({target:t.geometry},{duration:2e3,easing:"in-out-expo"})}))}highlightFeature(e){this.m_currentFilter=e.attributes.NAME,this.m_layers.ancLayer.featureEffect={filter:{where:`NAME = '${e.attributes.NAME}'`},excludedLabelsVisible:!0,includedEffect:"brightness(5) hue-rotate(270deg) contrast(200%)"}}render(){return t(s,null,t("slot",null),t("arcgis-hub-map",{style:{height:"400px"},zoom:"10",center:"-77.05,38.9",basemap:"gray-vector"}))}};d.style=":host{display:block}";export{a as dc_election_question,l as dc_filter,c as dc_loader,d as dc_map}